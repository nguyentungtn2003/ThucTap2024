<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Dashboard - Quản lý khách hàng</title>
    <style>
        /* CSS styles remain unchanged as per your original code */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #0d1117;
            color: #c9d1d9;
        }

        .sidebar {
            width: 250px;
            background-color: #161b22;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            padding: 20px 0;
        }

        .sidebar h1 {
            color: #58a6ff;
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .sidebar .admin-info {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin-bottom: 20px;
        }

        .sidebar .admin-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }

        .sidebar .admin-info .name {
            color: #c9d1d9;
            font-size: 1rem;
        }

        .sidebar .admin-info .role {
            font-size: 0.9rem;
            color: #8b949e;
        }

        .sidebar a {
            text-decoration: none;
            color: #c9d1d9;
            padding: 15px 20px;
            display: block;
            border-radius: 5px;
            margin: 5px 10px;
        }

        .sidebar a:hover, .sidebar a.active {
            background-color: #21262d;
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 1.5rem;
        }

        .header button {
            background-color: #22303f;
            border: none;
            padding: 10px 20px;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
        }

        .header button:hover {
            background-color: #1f6feb;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: #161b22;
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .stat-card h2 {
            margin: 0;
            font-size: 2rem;
        }

        .stat-card p {
            margin: 5px 0 0;
            color: #8b949e;
        }

        .tables {
            display: flex;
            gap: 20px;
        }

        .table-card {
            background-color: #161b22;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            overflow-x: auto;
        }

        .table-card h3 {
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #c9d1d9;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #21262d;
        }

        th {
            background-color: #21262d;
        }

        .btn {
            background-color: #58a6ff;
            border: none;
            padding: 5px 10px;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn:hover {
            background-color: #1f6feb;
        }

        .status-visible {
            color: #3fb950;
        }
        .btn.active {
            background-color: #1f6feb;
            color: white;
            font-weight: bold;
        }
        .side-form {
            position: fixed;
            top: 0;
            right: -100%;
            width: 30%;
            height: 100%;
            background-color: #161b22;
            padding: 20px;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
            transition: right 0.3s ease-in-out;
            z-index: 1000;
        }

        .side-form.active {
            right: 0;
        }

        .side-form h2 {
            margin-top: 0;
            color: #58a6ff;
        }

        .side-form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .side-form input, .side-form select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #21262d;
            border-radius: 5px;
            background-color: #0d1117;
            color: #c9d1d9;
        }

        .side-form button {
            background-color: #58a6ff;
            border: none;
            padding: 10px 20px;
            color: #fff;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            width: 100%;
        }

        .side-form button:hover {
            background-color: #1f6feb;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }

        .overlay.active {
            display: block;
        }
        /*!* Form styling *!*/
        /*.form-group {*/
        /*    margin-bottom: 15px;*/
        /*}*/

        /*label {*/
        /*    font-weight: bold;*/
        /*    display: block;*/
        /*    margin-bottom: 5px;*/
        /*}*/

        /*input[type="text"],*/
        /*input[type="date"],*/
        /*input[type="file"] {*/
        /*    width: 100%;*/
        /*    padding: 8px;*/
        /*    box-sizing: border-box;*/
        /*}*/

        /*button[type="submit"] {*/
        /*    background-color: purple;*/
        /*    color: white;*/
        /*    border: none;*/
        /*    padding: 10px 15px;*/
        /*    cursor: pointer;*/
        /*    font-weight: bold;*/
        /*}*/

        /*button[type="submit"]:hover {*/
        /*    background-color: darkmagenta ;*/
        /*}*/

        /*.error-message {*/
        /*    color: red;*/
        /*    font-size: 0.875em;*/
        /*}*/
        /* General Form Styling */
        .form-group {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        /* Layout for 2 columns */
        .form-row {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        /* Styling for labels */
        label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95rem;
        }

        /* Styling for Inputs */
        input[type="text"],
        input[type="date"],
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9rem;
            box-sizing: border-box;
            margin-top: 8px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="file"]:focus {
            border-color: #6c63ff;
            outline: none;
            box-shadow: 0 0 5px rgba(108, 99, 255, 0.3);
        }

        /* File Upload Section */
        input[type="file"] {
            padding: 5px;
            background-color: #fafafa;
            color: #555;
        }

        /* Styling for Buttons */
        button[type="submit"] {
            background-color: #6c63ff;
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
            margin-top: 15px;
        }

        button[type="submit"]:hover {
            background-color: #4e4bff;
        }

        /* Styling for Error Messages */
        .error-message {
            color: #e74c3c;
            font-size: 0.875rem;
            margin-top: 5px;
        }

        /* Form Layout */
        form {
            background-color: #f9f9f9;
            padding: 25px 35px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            margin: 0 auto;
            font-family: 'Arial', sans-serif;
        }

        /* Header */
        .header {
            margin-bottom: 25px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 15px;
        }

        .header a {
            display: inline-block;
            background-color: #ff4d4d;
            color: white;
            padding: 12px 20px;
            text-decoration: none;
            font-weight: bold;
            border-radius: 5px;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .header a:hover {
            background-color: #e63946;
        }

        /* Image Preview */
        #imagePreview {
            max-width: 200px;
            height: auto;
            margin-top: 15px;
        }

        #removeImageBtn {
            margin-top: 10px;
            padding: 6px 12px;
            background-color: #e74c3c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }

        #removeImageBtn:hover {
            background-color: #c0392b;
        }

        /* File Size Error Message */
        #fileSizeError {
            margin-top: 12px;
            font-size: 0.875rem;
            color: #e74c3c;
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }

            button[type="submit"] {
                width: auto;
                padding: 12px 20px;
            }

            .header h1 {
                font-size: 1.6rem;
            }

            .header a {
                width: 100%;
                text-align: center;
            }
            /* Form Styling: Adjust .form-row for grouping elements */
            .form-row {
                display: flex;
                justify-content: space-between;
                gap: 15px;
            }

            .form-row .form-group {
                flex: 1;
                margin-bottom: 0;
            }

            /* Adjust width for time and date fields */
            .form-row .form-group.time-date {
                flex: 0.48;
            }

        }

        /* To save space, I'm omitting the unchanged CSS from your original file */
    </style>
</head>
<body>

<div class="sidebar">
    <h1>ADMIN 1</h1>
    <!-- Admin Info -->
    <div class="admin-info">
        <img src="admin1.jpg" alt="Admin Avatar">
        <div>
            <div class="name">John Doe</div>
            <div class="role">Admin</div>
        </div>
    </div>
    <!-- Sidebar Menu -->
    <a href="ad1_mainboard.html">Adminboard</a>
    <a href="/admin/staff-management">Quản lý nhân viên</a>
    <a href="/admin/showtime-management">Quản lý suất chiếu</a>
    <a href="/admin/tickets">Quản lý vé</a>
    <a href="/admin/typeofconcession/types">Quản lý đồ ăn</a>
    <a href="/movies/moviemanagement" class="active">Quản lý phim</a>
</div>


<div class="main-content">
    <div class="header">
        <h1>Quản Lý Phim</h1>
<!--        <a style="text-decoration: none;" th:href="@{/movies/addmovie}" class="btn btn-red">+ Thêm Phim</a>-->
    </div>

<!--    <form th:action="@{${movie.movieId != null && movie.movieId != 0} ? '/movies/update/' + ${movie.movieId} : '/movies/addmovie'}"-->
<!--          th:object="${movie}" method="post" enctype="multipart/form-data">-->

<!--        &lt;!&ndash; Hidden input to pass movieId &ndash;&gt;-->
<!--        <input type="hidden" th:field="*{movieId}" />-->
<!--        &lt;!&ndash; Movie Image &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="movieImage">Tải lên ảnh:</label>-->
<!--            <input type="file" id="movieImage" name="movieImage" accept="image/*" onchange="previewImage(event)" />-->
<!--            <div>-->
<!--                <img id="imagePreview" src="#" alt="Hình ảnh xem trước" style="display: none; margin-top: 10px; max-width: 200px; height: auto;" />-->
<!--                <button type="button" id="removeImageBtn" style="display: none; margin-top: 10px;" onclick="removeImage()">Xóa Ảnh</button>-->
<!--                <div id="fileSizeError" style="color: red; font-size: 0.875em; margin-top: 10px;"></div>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Movie Title &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="title1">Tên phim:</label>-->
<!--            <input type="text" id="title1" name="title1" placeholder="Nhập tên phim" th:field="*{title}"  />-->
<!--            <div th:if="${#fields.hasErrors('title')}" class="error-message">-->
<!--                <span th:errors="*{title}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Description &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="description1">Mô tả:</label>-->
<!--            <input type="text" id="description1" name="description1" placeholder="Nhập mô tả phim" th:field="*{description}"  />-->
<!--            <div th:if="${#fields.hasErrors('description')}" class="error-message">-->
<!--                <span th:errors="*{description}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Director &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="director1">Đạo diễn:</label>-->
<!--            <input type="text" id="director1" name="director1" placeholder="Nhập đạo diễn" th:field="*{director}"  />-->
<!--            <div th:if="${#fields.hasErrors('director')}" class="error-message">-->
<!--                <span th:errors="*{director}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Actor &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="actor1">Diễn viên:</label>-->
<!--            <input type="text" id="actor1" name="actor1" placeholder="Nhập tên diễn viên" th:field="*{actor}"  />-->
<!--            <div th:if="${#fields.hasErrors('actor')}" class="error-message">-->
<!--                <span th:errors="*{actor}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Running Time &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="runningTime1">Thời lượng:</label>-->
<!--            <input type="text" id="runningTime1" name="runningTime1" placeholder="Nhập thời lượng phim" th:field="*{runningTime}"  />-->
<!--            <div th:if="${#fields.hasErrors('runningTime')}" class="error-message">-->
<!--                <span th:errors="*{runningTime}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Genre &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <label for="version1">Thể loại:</label>-->
<!--            <input type="text" id="version1" name="version1" placeholder="Nhập thể loại phim" th:field="*{version}"  />-->
<!--            <div th:if="${#fields.hasErrors('version')}" class="error-message">-->
<!--                <span th:errors="*{version}"></span>-->
<!--            </div>-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="releaseDate1">Khởi chiếu:</label>-->
<!--            <input type="date" id="releaseDate1" name="releaseDate1" th:field="*{releaseDate}" />-->
<!--            <div th:if="${#fields.hasErrors('releaseDate')}" class="error-message">-->
<!--                <span th:errors="*{releaseDate}"></span>-->
<!--            </div>-->
<!--        </div>-->

<!--        &lt;!&ndash; Thể loại &ndash;&gt;-->
<!--        &lt;!&ndash;        <div class="form-group">&ndash;&gt;-->
<!--        &lt;!&ndash;            <label>Thể loại:</label>&ndash;&gt;-->
<!--        &lt;!&ndash;            <div th:each="type : ${movieTypes}">&ndash;&gt;-->
<!--        &lt;!&ndash;                <label>&ndash;&gt;-->
<!--        &lt;!&ndash;                    <input type="checkbox" name="typeIds" value="${type.typeId}" /> &lt;!&ndash; Checkbox cho từng thể loại &ndash;&gt;&ndash;&gt;-->
<!--        &lt;!&ndash;                    <span th:text="${type.typeName}"></span> &lt;!&ndash; Hiển thị tên thể loại &ndash;&gt;&ndash;&gt;-->
<!--        &lt;!&ndash;                </label>&ndash;&gt;-->
<!--        &lt;!&ndash;                <br />&ndash;&gt;-->
<!--        &lt;!&ndash;            </div>&ndash;&gt;-->
<!--        &lt;!&ndash;        </div>&ndash;&gt;-->
<!--        &lt;!&ndash; Submit Button &ndash;&gt;-->
<!--        <div class="form-group">-->
<!--            <button type="submit">Lưu thông tin phim</button>-->
<!--        </div>-->
<!--    </form>-->
    <form th:action="@{${movie.movieId != null && movie.movieId != 0} ? '/movies/update/' + ${movie.movieId} : '/movies/addmovie'}"
          th:object="${movie}" method="post" enctype="multipart/form-data">

        <!-- Movie Image -->
        <div class="form-group">
            <label for="movieImage">Tải lên ảnh:</label>
            <input type="file" id="movieImage" name="movieImage" accept="image/*" onchange="previewImage(event)" />
            <div>
                <img id="imagePreview" src="#" alt="Hình ảnh xem trước" style="display: none; margin-top: 10px; max-width: 200px; height: auto;" />
                <button type="button" id="removeImageBtn" style="display: none; margin-top: 10px;" onclick="removeImage()">Xóa Ảnh</button>
                <div id="fileSizeError" style="color: red; font-size: 0.875em; margin-top: 10px;"></div>
            </div>
        </div>

        <!-- Movie Info -->
        <div class="form-row">
            <!-- Movie Title -->
            <div class="form-group">
                <label for="title1">Tên phim:</label>
                <input type="text" id="title1" name="title1" placeholder="Nhập tên phim" th:field="*{title}"  />
                <div th:if="${#fields.hasErrors('title')}" class="error-message">
                    <span th:errors="*{title}"></span>
                </div>
            </div>

            <!-- Director -->
            <div class="form-group">
                <label for="director1">Đạo diễn:</label>
                <input type="text" id="director1" name="director1" placeholder="Nhập đạo diễn" th:field="*{director}"  />
                <div th:if="${#fields.hasErrors('director')}" class="error-message">
                    <span th:errors="*{director}"></span>
                </div>
            </div>
        </div>

        <div class="form-row">
            <!-- Description -->
            <div class="form-group">
                <label for="description1">Mô tả:</label>
                <input type="text" id="description1" name="description1" placeholder="Nhập mô tả phim" th:field="*{description}"  />
                <div th:if="${#fields.hasErrors('description')}" class="error-message">
                    <span th:errors="*{description}"></span>
                </div>
            </div>

            <!-- Actor -->
            <div class="form-group">
                <label for="actor1">Diễn viên:</label>
                <input type="text" id="actor1" name="actor1" placeholder="Nhập tên diễn viên" th:field="*{actor}"  />
                <div th:if="${#fields.hasErrors('actor')}" class="error-message">
                    <span th:errors="*{actor}"></span>
                </div>
            </div>
        </div>

        <!-- Time and Date Fields in the Same Row -->
        <div class="form-row">
            <!-- Running Time -->
            <div class="form-group time-date">
                <label for="runningTime1">Thời lượng:</label>
                <input type="text" id="runningTime1" name="runningTime1" placeholder="Nhập thời lượng phim" th:field="*{runningTime}"  />
                <div th:if="${#fields.hasErrors('runningTime')}" class="error-message">
                    <span th:errors="*{runningTime}"></span>
                </div>
            </div>

            <!-- Release Date -->
            <div class="form-group time-date">
                <label for="releaseDate1">Khởi chiếu:</label>
                <input type="date" id="releaseDate1" name="releaseDate1" th:field="*{releaseDate}" />
                <div th:if="${#fields.hasErrors('releaseDate')}" class="error-message">
                    <span th:errors="*{releaseDate}"></span>
                </div>
            </div>
        </div>

        <!-- Genre -->
        <div class="form-group">
            <label for="version1">Version:</label>
            <input type="text" id="version1" name="version1" placeholder="Nhập thể loại phim" th:field="*{version}"  />
            <div th:if="${#fields.hasErrors('version')}" class="error-message">
                <span th:errors="*{version}"></span>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="form-group">
            <button type="submit">Lưu thông tin phim</button>
        </div>
    </form>






    <div class="search-bar" style="width: 100%; text-align: center; margin: 20px 0;">
        <input
                type="text"
                placeholder="Search..."
                oninput="searchMovies(this.value)"
                style="
            width: 50%;
            height: 25px;
            font-size: 16px;
            padding: 10px 15px;
            border-radius: 25px;
            border: 2px solid #ccc;
            outline: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        "
                onfocus="this.style.borderColor='#4CAF50'; this.style.boxShadow='0 4px 8px rgba(0, 0, 0, 0.3)';"
                onblur="this.style.borderColor='#ccc'; this.style.boxShadow='0 2px 5px rgba(0, 0, 0, 0.2)';"
        >
    </div>


    <div class="tables">
        <div class="table-card">
            <div th:if="${message}" class="flash-message" th:text="${message}"></div>
            <div th:if="${error}" class="flash-message" th:text="${error}"></div>
            <h3>Danh Sách Phim</h3>
            <table>

                <tbody id="customerTable">
                <table>
                    <thead>
                    <tr>
                        <th>Movie</th>
                        <th>Description</th>
                        <th>Running Time</th>
                        <th>Release Date</th>
                        <!--                <th>Movie Type</th>-->
                        <th>Version</th>
                        <th>Actor</th>
                        <th>Director</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Lặp qua danh sách movies và hiển thị thông tin -->
                    <tr th:each="movie : ${movies}">
                        <td th:text="${movie.title}">Title</td>
                        <td th:text="${movie.description}">Description</td>
                        <td th:text="${movie.getRunningTime()}">Running Time</td>
                        <td th:text="${#dates.format(movie.releaseDate, 'yyyy-MM-dd')}">Release Date</td>
                        <!--                <td th:text="">Movie Type</td>-->
                        <td th:text="${movie.version}">Version</td>
                        <td th:text="${movie.actor}">Actor</td>
                        <td th:text="${movie.director}">Director</td>
                        <td>
                            <!-- Form để gửi yêu cầu AJAX khi checkbox thay đổi -->
                            <label class="switch">
                                <input type="checkbox"
                                       th:checked="${movie.isShowing == 1}"
                                       th:onclick="|updateMovieStatus(${movie.movieId}, this)|">
                                <span class="slider"></span>
                            </label>
                        </td>

                        <td class="btn-group" style="display: flex; gap: 10px;">
                            <!-- Nút Edit -->
                            <a th:href="@{/movies/update/{id}(id=${movie.movieId})}" class="btn btn-green">
                                <i class="fas fa-edit"></i>
                            </a>
                            <!-- Nút Delete -->
                            <a th:href="@{/movies/delete/{id}(id=${movie.movieId})}" class="btn btn-red">
                                <i class="fas fa-trash"></i>
                            </a>
                        </td>


                        <!--                <td class="btn-group">-->
                        <!--                    <button class="btn btn-green">-->
                        <!--                        <i class="fas fa-edit"></i>-->
                        <!--                    </button>-->
                        <!--                    &lt;!&ndash; Chỉ sử dụng onclick để gọi hàm confirmDelete với URL xóa động &ndash;&gt;-->
                        <!--                    <a href="#" class="btn btn-red" onclick="confirmDelete('@{/movies/delete/{id}(id=${movie.movieId})}')">-->
                        <!--                        <i class="fas fa-trash"></i>-->
                        <!--                    </a>-->
                        <!--                </td>-->




                    </tr>
                    </tbody>
                </table>
                </tbody>
            </table>
            <div id="pagination" style="margin-top: 10px; display: flex; justify-content: center;">
                <!-- JavaScript will handle pagination links -->
            </div>
        </div>
    </div>
</div>
<div class="side-form" id="sideForm">
    <h2>Thêm Phim</h2>
    <form>
        <label for="image">Ảnh:</label>
        <input type="file" id="image" name="image" accept="image/*">

        <label for="name">Tên Phim:</label>
        <input type="text" id="name" name="name" required>

        <label for="description">Mô Tả:</label>
        <textarea id="description" name="description" required></textarea>

        <label for="director">Đạo Diễn:</label>
        <input type="text" id="director" name="director" required>

        <label for="actor">Diễn Viên:</label>
        <input type="text" id="actor" name="actor" required>

        <label for="time">Thời Lượng:</label>
        <input type="text" id="time" name="time" required>

        <label for="type">Thể Loại:</label>
        <input type="text" id="type" name="type" required>

        <label for="releaseDate">Ngày Chiếu:</label>
        <input type="date" id="releaseDate" name="releaseDate" required>

        <button type="submit" class="btn">Lưu</button>
    </form>
</div>
<div class="overlay" id="overlay"></div>


<script>
    function previewImage(event) {
        const file = event.target.files[0]; // Lấy tệp được chọn
        const preview = document.getElementById('imagePreview'); // Hình ảnh xem trước
        const removeBtn = document.getElementById('removeImageBtn'); // Nút xóa ảnh
        const fileSizeError = document.getElementById('fileSizeError'); // Lỗi kích thước tệp
        const inputFile = document.getElementById('movieImage'); // Trường input tệp

        // Kiểm tra nếu không có tệp
        if (!file) {
            resetImagePreview();
            return;
        }

        // Kiểm tra định dạng tệp
        const allowedExtensions = ['jpg', 'jpeg', 'png', 'gif']; // Đuôi tệp được chấp nhận
        const fileExtension = file.name.split('.').pop().toLowerCase(); // Lấy đuôi tệp
        if (!allowedExtensions.includes(fileExtension)) {
            fileSizeError.textContent = "Định dạng tệp không hợp lệ. Chỉ chấp nhận các tệp .jpg, .jpeg, .png, .gif.";
            resetImagePreview();
            inputFile.value = ""; // Xóa tệp không hợp lệ
            return;
        }

        // Giới hạn kích thước tệp (5MB)
        const maxFileSize = 5 * 1024 * 1024; // 5MB
        if (file.size > maxFileSize) {
            fileSizeError.textContent = "Kích thước tệp quá lớn. Vui lòng chọn ảnh nhỏ hơn 5MB.";
            resetImagePreview();
            inputFile.value = ""; // Xóa tệp không hợp lệ
            return;
        }

        // Nếu không có lỗi
        fileSizeError.textContent = ""; // Xóa thông báo lỗi
        const reader = new FileReader(); // Tạo đối tượng FileReader

        reader.onload = function (e) {
            preview.src = e.target.result; // Đặt đường dẫn ảnh
            preview.style.display = 'block'; // Hiển thị hình ảnh
            removeBtn.style.display = 'inline-block'; // Hiển thị nút xóa
        };

        reader.readAsDataURL(file); // Đọc nội dung tệp dưới dạng URL
    }
    function removeImage() {
        const preview = document.getElementById('imagePreview'); // Hình ảnh xem trước
        const removeBtn = document.getElementById('removeImageBtn'); // Nút xóa ảnh
        const inputFile = document.getElementById('movieImage'); // Trường input
        const fileSizeError = document.getElementById('fileSizeError'); // Lỗi kích thước tệp

        // Đặt lại trạng thái mặc định
        inputFile.value = ""; // Xóa tệp đã chọn
        preview.src = "#"; // Xóa đường dẫn ảnh
        preview.style.display = "none"; // Ẩn hình ảnh
        removeBtn.style.display = "none"; // Ẩn nút xóa
        fileSizeError.textContent = ""; // Xóa lỗi
    }
    function updateMovieStatus(movieId, checkbox) {
        const isShowing = checkbox.checked ? 1 : 0; // Chuyển trạng thái checkbox thành 1 hoặc 0

        // Gửi yêu cầu AJAX để cập nhật trạng thái
        fetch(`/movies/updateStatus`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                movieId: movieId,
                isShowing: isShowing
            })
        })
            .then(response => {
                if (response.ok) {
                    console.log('Movie status updated successfully!');
                } else {
                    console.error('Error updating movie status');
                    // Nếu có lỗi, reset lại trạng thái checkbox
                    checkbox.checked = !checkbox.checked;
                }
            })
            .catch(error => {
                console.error('Error updating movie status:', error);
                // Nếu có lỗi, reset lại trạng thái checkbox
                checkbox.checked = !checkbox.checked;
            });
    }

    function searchMovies(query) {
        // Lấy tất cả các dòng của bảng
        const rows = document.querySelectorAll("table tbody tr");

        // Duyệt qua từng dòng trong bảng và ẩn/hiển thị tùy thuộc vào tiêu đề phim có khớp với từ khóa tìm kiếm hay không
        rows.forEach(row => {
            const title = row.querySelector("td:nth-child(1)").innerText.toLowerCase(); // Lấy tiêu đề phim
            if (title.includes(query.toLowerCase())) {
                row.style.display = ""; // Hiển thị dòng nếu khớp
            } else {
                row.style.display = "none"; // Ẩn dòng nếu không khớp
            }
        });
    }
    function changeEntriesPerPage(entriesPerPage) {
        // Lưu lại số lượng entry được chọn
        localStorage.setItem('entriesPerPage', entriesPerPage);

        // Nếu bạn đang lấy dữ liệu từ backend qua API
        fetchMovies(entriesPerPage);
    }

    // Hàm để gọi API và lấy dữ liệu mới (nếu cần)
    function fetchMovies(entriesPerPage) {
        const url = `/movies?entriesPerPage=${entriesPerPage}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                // Xử lý dữ liệu và cập nhật bảng phim
                updateMovieTable(data.movies);
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    // Hàm cập nhật bảng phim
    function updateMovieTable(movies) {
        const tableBody = document.querySelector('table tbody');
        tableBody.innerHTML = ''; // Xóa dữ liệu hiện tại

        movies.forEach(movie => {
            const row = document.createElement('tr');
            row.innerHTML = `
            <td>${movie.title}</td>
            <td>${movie.description}</td>
            <td>${movie.runningTime}</td>
            <td>${movie.releaseDate}</td>
            <td>${movie.version}</td>
            <td>${movie.actor}</td>
            <td>${movie.director}</td>
            <td>${movie.isShowing ? 'Showing' : 'Not Showing'}</td>
            <td>
                <a href="/movies/update/${movie.movieId}" class="btn btn-green"><i class="fas fa-edit"></i></a>
                <a href="/movies/delete/${movie.movieId}" class="btn btn-red"><i class="fas fa-trash"></i></a>
            </td>
        `;
            tableBody.appendChild(row);
        });
    }


</script>
</body>
</html>
