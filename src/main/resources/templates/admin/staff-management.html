<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Interface - Qu·∫£n l√Ω Nh√¢n Vi√™n</title>
<!--  <link rel="stylesheet" href="../styles.css">-->
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #18191a;
      color: #fff;
      display: flex;
    }

    /* Top Header */
      .header {
        background-color: black;
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-top: 3px solid purple;
        border-bottom: 1px solid black;
      }

      /* Sidebar */
    .sidebar {
      width: 250px;
      background-color: #242526;
      height: 100vh;
      padding: 20px 0;
      position: fixed;
    }

    .sidebar a {
      display: block;
      color: #ddd;
      padding: 15px 25px;
      text-decoration: none;
    }

    .sidebar a:hover,
    .sidebar a.active {
      background-color: #e50914;
      color: #fff;
    }

    .sidebar .logo {
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
      color: #e50914;
    }

      /* Main Content */
      .main-content {
        margin-left: 200px; /* Width of the sidebar */
        padding: 20px;
        height: calc(100vh - 45px); /* Adjust for header height */
      }

      /* Form Styles */
      .form-container {
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 5px;
        max-width: 500px;
        margin-bottom: 20px;
      }

      .form-container h2 {
        margin-top: 0;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: black;
      }

      .form-group input[type="text"],
      .form-group input[type="email"],
      .form-group input[type="password"],
      .form-group input[type="date"] {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
      }

      .form-group .radio-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th, td {
        padding: 10px;
        text-align: left;
      }

      th {
        background-color: black;
        color: white;
        font-weight: bold;
      }

      /* Row colors */
      tr:nth-child(odd) {
        background-color: #d9a5a5; /* Red color for odd rows */
      }

      tr:nth-child(even) {
        background-color: #c3d0d9; /* Blue color for even rows */
      }

      /* Icons */
      .icon {
        margin: 0 5px;
        cursor: pointer;
      }

      .icon:hover {
        opacity: 0.7;
      }

      button {
        background-color: #4CAF50; /* M√†u n·ªÅn xanh l√° c√¢y */
        color: white; /* M√†u ch·ªØ tr·∫Øng */
        padding: 10px 20px; /* Kho·∫£ng c√°ch b√™n trong */
        font-size: 16px; /* K√≠ch th∆∞·ªõc ch·ªØ */
        border: none; /* X√≥a vi·ªÅn m·∫∑c ƒë·ªãnh */
        border-radius: 5px; /* Bo g√≥c */
        cursor: pointer; /* Thay ƒë·ªïi con tr·ªè chu·ªôt th√†nh h√¨nh b√†n tay */
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* T·∫°o hi·ªáu ·ª©ng ƒë·ªï b√≥ng */
        transition: background-color 0.3s ease; /* Hi·ªáu ·ª©ng chuy·ªÉn m√†u khi hover */
      }

      button:hover {
        background-color: #4CAF50; /* ƒê·ªïi m√†u khi di chu·ªôt */
      }

      button:active {
        background-color: #4CAF50; /* ƒê·ªïi m√†u khi nh·∫•n v√†o */
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1); /* Gi·∫£m ƒë·ªï b√≥ng khi nh·∫•n */
        transform: translateY(2px); /* T·∫°o hi·ªáu ·ª©ng nh·∫•n xu·ªëng */
      }
      .pagination-container {
        margin-top: 20px;
        text-align: center;
      }
      .pagination-container button {
        margin: 0 5px;
        padding: 5px 10px;
        cursor: pointer;
      }
      .pagination-container button.active {
        background-color: #4CAF50;
        color: white;
        border: none;
      }
      .error-message {
        color: red;
        font-size: 0.9em;
        display: block;
      }

      #editStaffModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none; /* ·∫®n modal ban ƒë·∫ßu */
        justify-content: center;
        align-items: center;
      }

      #editStaffModal form {
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        display: flex;
        flex-direction: column;
        width: 700px; /* ƒêi·ªÅu ch·ªânh ƒë·ªô r·ªông c·ªßa form */
        gap: 5px; /* Th√™m kho·∫£ng c√°ch gi·ªØa c√°c tr∆∞·ªùng */
      }

      /* C√°c tr∆∞·ªùng nh·∫≠p li·ªáu */
      #editStaffModal input,
      #editStaffModal select {
        padding: 10px; /* Th√™m kho·∫£ng c√°ch b√™n trong tr∆∞·ªùng */
        font-size: 16px; /* TƒÉng k√≠ch th∆∞·ªõc ch·ªØ */
        margin-bottom: 10px; /* T·∫°o kho·∫£ng c√°ch gi·ªØa c√°c tr∆∞·ªùng */
        border: 1px solid #ccc; /* ƒê·∫∑t vi·ªÅn cho c√°c tr∆∞·ªùng */
        border-radius: 4px; /* L√†m tr√≤n g√≥c c√°c tr∆∞·ªùng */
      }

      /* C√°c n√∫t L∆∞u v√† H·ªßy */
      #editStaffModal .button-container {
        display: flex;
        justify-content: space-between; /* T√°ch n√∫t ra */
      }

      #editStaffModal .button-container button {
        padding: 10px 10px;
        font-size: 16px; /* TƒÉng k√≠ch th∆∞·ªõc ch·ªØ c·ªßa n√∫t */
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      #editStaffModal .button-container .save-button {
        background-color: #4CAF50; /* M√†u xanh cho n√∫t l∆∞u */
        color: white;
      }

      #editStaffModal .button-container .cancel-button {
        background-color: #f44336; /* M√†u ƒë·ªè cho n√∫t h·ªßy */
        color: white;
      }

      #editStaffModal .button-container button:hover {
        opacity: 0.8; /* Hi·ªáu ·ª©ng khi hover */
      }
    </style>
  </head>
  <body>

  <!-- Top Header -->
  <div class="header">
    <div>ADMIN 2</div>
    <div><a href="../login.html" style="color: white; text-decoration: none;">ƒêƒÉng xu·∫•t</a></div>
  </div>

  <!-- Sidebar -->
  <div class="sidebar">
    <a href="/admin/staff-management">QU·∫¢N L√ç NH√ÇN VI√äN</a>
    <a href="/admin/showtime-management">QU·∫¢N L√ç SU·∫§T CHI·∫æU</a>
      <a href="/admin/ad2_room_mana.html">QU·∫¢N L√ç PH√íNG CHI·∫æU</a>
    <a href="/admin/ad2_cus_mana.html">QU·∫¢N L√ç KH√ÅCH H√ÄNG</a>
    <a href="/admin/ad2_addcus.html">TH√äM M·ªöI KH√ÅCH H√ÄNG</a>
    <a href="/admin/ad2_ticket_mana.html">QU·∫¢N L√ç V√â</a>
    <a href="/admin/ad2_addtick.html">TH√äM V√â</a>
    <a href="/admin/ad2_mv_mana.html">QU·∫¢N L√ç PHIM</a>
    <a href="/admin/ad2_addmovie.html">TH√äM PHIM</a>
    <a href="/admin/admin2.html">TH√îNG TIN C√Å NH√ÇN</a>
  </div>

<!-- Main Content Area -->
<div class="main-content">
  <h1>Qu·∫£n L√Ω Nh√¢n Vi√™n</h1>

  <!-- Form Th√™m Nh√¢n Vi√™n M·ªõi -->
  <div class="form-container">
    <h2>Th√™m Nh√¢n Vi√™n M·ªõi</h2>
    <form id="addStaffForm">
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="email" required>
        <div id="emailError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>H·ªç T√™n:</label>
        <input type="text" id="name" required>
        <div id="nameError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>M·∫≠t Kh·∫©u:</label>
        <input type="password" id="password" required>
        <div id="passwordError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>S·ªë ƒêi·ªán Tho·∫°i:</label>
        <input type="text" id="phoneNumber" required>
        <div id="phoneNumberError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>ƒê·ªãa Ch·ªâ:</label>
        <input type="text" id="address" required>
        <div id="addressError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>Ng√†y Sinh:</label>
        <input type="date" id="dob" required>
        <div id="dobError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>Gi·ªõi T√≠nh:</label>
        <div class="radio-group">
          <label><input type="radio" name="sex" value="M" required> Nam</label>
          <label><input type="radio" name="sex" value="F"> N·ªØ</label>
        </div>
        <div id="sexError" class="error-message"></div>
      </div>
      <div class="form-group">
        <label>Tr·∫°ng Th√°i:</label>
        <div class="radio-group">
          <label><input type="radio" name="status" value="Active" required> Active</label>
          <label><input type="radio" name="status" value="Inactive"> Inactive</label>
        </div>
        <div id="statusError" class="error-message"></div>
      </div>
      <button type="button" onclick="addStaff()">Th√™m Nh√¢n Vi√™n</button>
    </form>
  </div>
  <div id="successMessage" style="display: none; color: green; font-size: 16px; padding: 10px; margin-top: 10px;">
    C·∫≠p nh·∫≠t th√†nh c√¥ng!
  </div>
  <!-- Danh s√°ch Nh√¢n Vi√™n -->
  <div class="table-container">
    <table id="staffTable">
      <thead>
      <tr>
        <th>ID</th>
        <th>name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Dob</th>
        <th>Phone</th>
        <th>Address</th>
        <th>Sex</th>
        <th>Status</th>
        <th>Qu·∫£n L√Ω</th>
      </tr>
      </thead>
      <tbody id="staffTableBody">
      <!-- D·ªØ li·ªáu nh√¢n vi√™n s·∫Ω ƒë∆∞·ª£c th√™m ·ªü ƒë√¢y b·∫±ng JavaScript -->

      </tbody>
    </table>
  </div>
  <div id="pagination" class="pagination-container"></div>

  <div id="editStaffModal" style="display: none;">
    <form id="editStaffForm">
      <label>H·ªç T√™n:</label>
      <input type="text" id="editname" required><br>
      <label>S·ªë ƒêi·ªán Tho·∫°i:</label>
      <input type="text" id="editPhoneNumber" required><br>
      <label>ƒê·ªãa Ch·ªâ:</label>
      <input type="text" id="editAddress" required><br>
      <label>Ng√†y Sinh:</label>
      <input type="date" id="editDob" required><br>
      <label>Gi·ªõi T√≠nh:</label>
      <select id="editSex">
        <option value="M">Nam</option>
        <option value="F">N·ªØ</option>
      </select><br>
      <label>Tr·∫°ng Th√°i:</label>
      <select id="editStatus">
        <option value="Active">Active</option>
        <option value="Inactive">Inactive</option>
      </select><br>
      <button type="button" onclick="saveStaffChanges()">L∆∞u Thay ƒê·ªïi</button>
      <button type="button" onclick="closeEditModal()">H·ªßy</button>
    </form>
  </div>

</div>

<script>
  // H√†m th√™m nh√¢n vi√™n
  function addStaff() {
    const email = document.getElementById("email").value;
    const name = document.getElementById("name").value;
    const password = document.getElementById("password").value;
    const phoneNumber = document.getElementById("phoneNumber").value;
    const address = document.getElementById("address").value;
    const dob = document.getElementById("dob").value;
    const sex = document.querySelector('input[name="sex"]:checked').value;
    const status = document.querySelector('input[name="status"]:checked').value;

    let isValid = true; // Bi·∫øn ki·ªÉm tra t√≠nh h·ª£p l·ªá c·ªßa form

    // X√≥a l·ªói c≈©
    document.querySelectorAll(".error-message").forEach(error => error.textContent = "");

    // Ki·ªÉm tra tr∆∞·ªùng h·ª£p r·ªóng (blank)
    if (!email) {
      document.getElementById("emailError").textContent = "Email kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!name) {
      document.getElementById("nameError").textContent = "H·ªç t√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!password) {
      document.getElementById("passwordError").textContent = "M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!phoneNumber) {
      document.getElementById("phoneNumberError").textContent = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!address) {
      document.getElementById("addressError").textContent = "ƒê·ªãa ch·ªâ kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!dob) {
      document.getElementById("dobError").textContent = "Ng√†y sinh kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!sex) {
      document.getElementById("sexError").textContent = "Gi·ªõi t√≠nh kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }
    if (!status) {
      document.getElementById("statusError").textContent = "Tr·∫°ng th√°i kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng.";
      isValid = false;
    }



    if (!email.includes("@")) {
      document.getElementById("emailError").textContent = "Email kh√¥ng h·ª£p l·ªá.";
      isValid = false;
    }

    // Ki·ªÉm tra t√™n ƒë·∫ßy ƒë·ªß
    if (name.trim().length < 3) {
      document.getElementById("nameError").textContent = "H·ªç t√™n ph·∫£i c√≥ √≠t nh·∫•t 3 k√Ω t·ª±.";
      isValid = false;
    }

    // Ki·ªÉm tra m·∫≠t kh·∫©u
    const passwordRegex = /^(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
    if (!passwordRegex.test(password)) {
      document.getElementById("passwordError").textContent =
              "M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 8 k√Ω t·ª± v√† 1 k√Ω t·ª± ƒë·∫∑c bi·ªát (!@#$%^&*).";
      isValid = false;
    }

    // Ki·ªÉm tra s·ªë ƒëi·ªán tho·∫°i
    const phoneRegex = /^[0-9]{10}$/;
    if (!phoneRegex.test(phoneNumber)) {
      document.getElementById("phoneNumberError").textContent = "S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ch·ªØ s·ªë.";
      isValid = false;
    }

    // N·∫øu form kh√¥ng h·ª£p l·ªá, kh√¥ng g·ªçi API
    if (!isValid) {
      return;
    }

    // N·∫øu t·∫•t c·∫£ c√°c tr∆∞·ªùng h·ª£p h·ª£p l·ªá, ti·∫øp t·ª•c g·ªçi API th√™m nh√¢n vi√™n
    fetch('/admin/staff', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        email, name, password, phoneNumber, address, dob, sex, status
      })
    })
            .then(response => response.text())
            .then(data => {
              const successMessage = document.getElementById("successMessage");
              successMessage.textContent = "Th√™m nh√¢n vi√™n th√†nh c√¥ng!";
              successMessage.style.display = "block"; // Hi·ªÉn th·ªã th√¥ng b√°o

              // ·∫®n th√¥ng b√°o sau 3 gi√¢y
              setTimeout(() => {
                successMessage.style.display = "none";
              }, 3000);
              loadStaffList(); // T·∫£i l·∫°i danh s√°ch sau khi th√™m m·ªõi
              document.getElementById("addStaffForm").reset(); // X√≥a n·ªôi dung form
            })
            .catch(error => console.error('Error adding staff:', error));
  }


  // H√†m t·∫£i danh s√°ch nh√¢n vi√™n
  let currentPage = 0;
  const pageSize = 4;

  function loadStaffList(page = 0) {
    console.log("Page number:", page);
    fetch(`/admin/staff?page=${page}&size=${pageSize}`)
            .then(response => response.json())
            .then(data => {
              console.log(data);
              const staffTableBody = document.getElementById("staffTableBody");
              staffTableBody.innerHTML = ""; // X√≥a n·ªôi dung c≈©

              data.content.forEach(staff => {
                const row = document.createElement("tr");
                row.innerHTML = `
          <td>${staff.id}</td>
          <td>${staff.name}</td>
          <td>${staff.email}</td>
          <td>${staff.roles.map(role => role.roleName).join(", ")}</td>
          <td>${staff.dob}</td>
          <td>${staff.phoneNumber}</td>
          <td>${staff.address}</td>
          <td>${staff.sex === 'M' ? 'Nam' : 'N·ªØ'}</td>
          <td>${staff.status}</td>
          <td>
            <span class="icon" onclick="editStaff(${staff.id})">‚úèÔ∏è</span>
            <span class="icon" onclick="deleteStaff(${staff.id})">üóëÔ∏è</span>
          </td>
        `;
                staffTableBody.appendChild(row);
              });

              // Hi·ªÉn th·ªã n√∫t ph√¢n trang
              const pagination = document.getElementById("pagination");
              pagination.innerHTML = "";

              for (let i = 0; i < data.totalPages; i++) {
                const pageButton = document.createElement("button");
                pageButton.innerText = i + 1;
                pageButton.className = i === page ? "active" : "";
                pageButton.onclick = () => loadStaffList(i);
                pagination.appendChild(pageButton);
              }
            })
            .catch(error => console.error('Error loading staff list:', error));
  }

  // G·ªçi h√†m loadStaffList khi trang ƒë∆∞·ª£c t·∫£i
  document.addEventListener("DOMContentLoaded", () => loadStaffList(currentPage));

  // H√†m X√≥a Nh√¢n Vi√™n
  function deleteStaff(id) {
    if (!confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n n√†y?")) return;

    fetch(`/admin/staff/${id}`, {
      method: 'DELETE'
    })
            .then(response => response.text())
            .then(data => {
              const successMessage = document.getElementById("successMessage");
              successMessage.textContent = "X√≥a nh√¢n vi√™n th√†nh c√¥ng!";
              successMessage.style.display = "block"; // Hi·ªÉn th·ªã th√¥ng b√°o

              // ·∫®n th√¥ng b√°o sau 3 gi√¢y
              setTimeout(() => {
                successMessage.style.display = "none";
              }, 3000);
              loadStaffList(); // T·∫£i l·∫°i danh s√°ch sau khi x√≥a
            });
  }

  // H√†m S·ª≠a Nh√¢n Vi√™n - ƒê√¢y l√† h√†m c∆° b·∫£n; c·∫ßn th√™m giao di·ªán ƒë·ªÉ c·∫≠p nh·∫≠t th√¥ng tin

  function editStaff(id) {
    // T√¨m th√¥ng tin nh√¢n vi√™n b·∫±ng ID
    fetch(`/admin/staff/${id}`)  // C·∫≠p nh·∫≠t ƒë∆∞·ªùng d·∫´n ƒë·ªÉ l·∫•y th√¥ng tin nh√¢n vi√™n theo ID
            .then(response => response.json())
            .then(staff => {
              // ƒêi·ªÅn th√¥ng tin v√†o c√°c tr∆∞·ªùng trong modal
              document.getElementById("editname").value = staff.name;
              document.getElementById("editPhoneNumber").value = staff.phoneNumber;
              document.getElementById("editAddress").value = staff.address;
              document.getElementById("editDob").value = staff.dob;
              document.getElementById("editSex").value = staff.sex;
              document.getElementById("editStatus").value = staff.status;

              // L∆∞u l·∫°i ID nh√¢n vi√™n c·∫ßn s·ª≠a trong form
              document.getElementById("editStaffForm").setAttribute("data-id", id);

              // Hi·ªÉn th·ªã modal
              document.getElementById("editStaffModal").style.display = "flex";
            })
            .catch(error => console.error('Error fetching staff details:', error));
  }

  // H√†m ƒë·ªÉ ƒë√≥ng modal
  function closeEditModal() {
    document.getElementById("editStaffModal").style.display = "none";
  }

  // H√†m ƒë·ªÉ l∆∞u thay ƒë·ªïi th√¥ng tin nh√¢n vi√™n
  function saveStaffChanges() {
    const id = document.getElementById("editStaffForm").getAttribute("data-id");
    const name = document.getElementById("editname").value;
    const phoneNumber = document.getElementById("editPhoneNumber").value;
    const address = document.getElementById("editAddress").value;
    const dob = document.getElementById("editDob").value;
    const sex = document.getElementById("editSex").value;
    const status = document.getElementById("editStatus").value;

    // G·ª≠i request PUT t·ªõi API ƒë·ªÉ c·∫≠p nh·∫≠t th√¥ng tin nh√¢n vi√™n
    fetch(`/admin/staff/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        name, phoneNumber, address, dob, sex, status
      })
    })
            .then(response => response.text())
            .then(data => {
              const successMessage = document.getElementById("successMessage");
              successMessage.textContent = "C·∫≠p nh·∫≠t th√†nh c√¥ng!";
              successMessage.style.display = "block"; // Hi·ªÉn th·ªã th√¥ng b√°o

              setTimeout(() => {
                successMessage.style.display = "none";
              }, 3000);

              loadStaffList(); // T·∫£i l·∫°i danh s√°ch sau khi c·∫≠p nh·∫≠t
              closeEditModal(); // ƒê√≥ng modal sau khi l∆∞u
            })
            .catch(error => console.error('Error updating staff:', error));
  }
</script>
</body>
</html>
